<?php echo $args['before_widget']; ?><?php if($instance['atitle']): ?><div class="text-header text-header__bg-white"><h3 class="widget-title"><a href="<?php the_term_link( $instance['cat'], 'category' ); ?>"><?php the_term_title( $instance['cat'], 'category' ); ?></a></h3></div><?php else: ?><div class="text-header text-header__bg-white"><h3 class="widget-title"><?php echo $instance['title']; ?></h3></div><?php endif; ?><?php $params = array( 'post_status' => 'publish', 'post_type' => array('post'), 'orderby' => $instance['order'], 'posts_per_page' => $instance['count'], 'paged' => 0, ); if($instance['cat'] > 0) { $params['tax_query'] = array( array( 'taxonomy' => 'category', 'field' => 'id', 'terms' => $instance['cat'], ), ); } ssdma_posts_process( 'post', $params ); ?><div class="g-posts"><?php while ( have_posts() ) : the_post(); ?><a href="<?php the_permalink() ?>" class="g-posts__item"><?php if ( has_post_thumbnail() ): ?><div class="g-posts__canvas"><?php the_post_thumbnail();; ?></div><?php else: ?><?php $content = get_the_content(); $img = false; if(preg_match_all ('/<img[^>]* src=\"[^\"]*\"[^>]*>/', $content, $matches )) { if(count($matches) && count($matches[0])) { $img = current($matches[0]); } } ?><?php if($img): ?><div class="g-posts__canvas"><?php echo $img; ?></div><?php endif; ?><?php endif; ?><div class="clearfix"></div><div class="g-posts__date"><div class="g-posts__date_day"><?php echo date('d'); ?></div><div class="g-posts__date_month"><?php echo get_the_time('M'); ?></div></div><div class="g-posts__text"><div class="g-posts__title text-overflow"><?php the_title(); ?></div><div class="g-posts__desc"><?php echo ssdma_str_length(get_the_excerpt(), 60); ?></div></div></a><?php endwhile; ?></div><?php wp_reset_query(); ?><?php echo $args['after_widget']; ?>